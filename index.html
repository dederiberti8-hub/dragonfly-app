function switchTab(t) {
            document.querySelectorAll('.page-content').forEach(p => p.style.display = 'none');
            document.querySelectorAll('.tab-item').forEach(i => i.classList.remove('active'));
            document.getElementById(t + '-page').style.display = 'block';
            document.getElementById('tab-' + t).classList.add('active');
            if(t === 'leaderboard') renderLeaderboard();
        }

        function renderLeaderboard() {
            db.ref('users').orderByChild('xp').limitToLast(10).once('value', (snap) => {
                let players = [];
                snap.forEach(c => players.push(c.val()));
                players.reverse();
                document.getElementById('leaderboard-list').innerHTML = players.map((u, i) => {
                    const r = RANKS.find(rank => u.xp >= rank.min && u.xp <= rank.max) || RANKS[0];
                    return <div class="card" style="margin-bottom:10px;"><div style="display:flex;align-items:center;width:100%"><span style="font-weight:bold;color:var(--neon-green);width:20px;">${i+1}</span><img src="${u.photo || ''}" style="width:35px;height:35px;border-radius:50%;border:1px solid var(--neon-green);margin-left:10px"><div style="display:flex;justify-content:space-between;flex-grow:1;align-items:center;margin-left:10px"><div><div style="font-size:12px;font-weight:bold">${u.name}</div><div style="font-size:9px;color:var(--neon-green)">${r.name}</div></div><b style="color:var(--neon-green)">${Math.floor(u.xp).toLocaleString()}</b></div></div></div>;
                }).join('');
            });
        }

        function toggleMissionList() {
            const list = document.getElementById('mission-list');
            const arrow = document.getElementById('mission-arrow');
            list.style.display = list.style.display === "none" ? "flex" : "none";
            arrow.innerText = list.style.display === "none" ? "▼" : "▲";
        }

        function toggleSettings() { 
            const m = document.getElementById('settings-modal'); 
            m.style.display = (m.style.display === 'flex') ? 'none' : 'flex'; 
        }

        function changeLang(l) { currentLang = l; updateUI(); renderMissions(); toggleSettings(); }

        // Jalankan load data saat window siap
        window.onload = loadData;
        
    </script>
</body>
</html>